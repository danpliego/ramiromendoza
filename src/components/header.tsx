import PropTypes from "prop-types";
import React, { useState } from "react";
import styled, { css } from "styled-components";
import * as Layout from "./layoutComponents";
import { Link } from "gatsby";
import { theme } from "./theme";
import { Dropdown, DropdownItem } from "./dropdown";

export const Header: React.FC = () => {
  const [openMenu, setOpenMenu] = useState(false);

  return (
    <HeaderContainer>
      <Layout.Container>
        <Layout.Row style={{ alignItems: "center" }}>
          <LogoContainer>
            <Link to="/">
              <svg
                width="185"
                height="33"
                viewBox="0 0 185 33"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M39.5486 17H42.5759V9.28634C42.5759 8.568 42.5588 7.79834 42.4391 7.19972H42.5246C42.6614 7.69572 42.8838 8.44828 43.1745 9.18372L46.561 17H49.8107L53.2998 9.16662C53.6077 8.48248 53.9326 7.54179 54.0352 7.19972H54.1037C53.9839 7.86676 53.9326 8.65352 53.9326 9.28634V17H57.1139V4.85655H51.8118L48.7161 12.1768C48.5279 12.6899 48.3569 13.1175 48.2885 13.5109H48.2543C48.1859 13.1175 48.0148 12.6899 47.8438 12.211L44.7139 4.85655H39.5486V17ZM61.5601 20.6088C64.2453 20.6088 65.7846 19.6681 67.0332 17.4276L71.9932 8.44828H68.4528L65.8531 13.5964C65.6649 14.0069 65.5794 14.1779 65.4426 14.52H65.3913C65.2544 14.1779 65.1689 14.0069 64.9466 13.5451L62.2613 8.44828H58.567L63.7664 17.0513L63.7151 17.1539C63.2533 17.7868 62.0903 18.0946 61.0299 18.0946C60.551 18.0946 59.9866 18.0433 59.5077 17.9749V20.4378C60.0721 20.5746 61.0299 20.6088 61.5601 20.6088ZM84.7252 10.6204C86.3672 10.2783 87.1197 9.16662 87.1197 7.93517C87.1197 6.20772 85.8199 4.85655 82.7754 4.85655H73.4883V17H82.8439C86.2303 17 87.4276 15.3239 87.4276 13.5451C87.4276 11.9545 86.5553 10.8941 84.7252 10.6204ZM81.8348 7.11421C83.203 7.11421 83.5451 7.76414 83.5451 8.36276C83.5451 9.02979 83.2543 9.76524 81.8348 9.76524H76.9432V7.11421H81.8348ZM81.9887 14.7423H76.9432V11.8519H81.9887C83.2886 11.8519 83.853 12.4334 83.853 13.2714C83.853 14.0924 83.3057 14.7423 81.9887 14.7423ZM93.896 17.325C95.9142 17.325 97.6417 16.5553 98.4113 14.9989V17H101.661V8.44828H98.36V12.0742C98.36 13.6477 97.368 15.0331 95.1959 15.0331C93.7079 15.0331 92.562 14.3148 92.562 12.2966V8.44828H89.261V13.0833C89.261 15.837 90.9713 17.325 93.896 17.325ZM109.975 17.325C113.721 17.325 115.465 16.2303 115.465 14.2806C115.465 12.7241 114.456 11.9374 111.942 11.7321L108.179 11.4414C107.324 11.373 106.982 11.1848 106.982 10.7743C106.982 10.2612 107.683 10.0389 109.188 10.0389C111.394 10.0389 112.797 10.3981 113.96 11.219L115.277 9.66262C113.926 8.61931 111.993 8.12331 109.479 8.12331C105.819 8.12331 103.954 9.064 103.954 10.9454C103.954 12.5189 105.1 13.357 107.58 13.5793L111.275 13.8872C112.147 13.9556 112.421 14.1437 112.421 14.5713C112.421 15.1357 111.805 15.3752 110.283 15.3752C107.632 15.3752 106.041 14.8108 104.929 13.8017L103.339 15.3068C104.724 16.6408 106.862 17.325 109.975 17.325ZM117.326 7.18262H120.815V4.56579H117.326V7.18262ZM117.429 17H120.73V8.44828H117.429V17ZM123.542 17H126.843V13.4767C126.843 11.5611 127.989 10.4836 129.99 10.4836C131.906 10.4836 132.812 11.4585 132.812 13.4425V17H136.113V12.9465C136.113 9.78234 134.437 8.12331 131.324 8.12331C129.169 8.12331 127.578 8.92717 126.774 10.4323V8.44828H123.542V17ZM150.474 12.9636C150.474 9.93628 148.148 8.12331 144.111 8.12331C140.263 8.12331 137.766 9.83365 137.766 12.7583C137.766 15.6317 140.178 17.325 144.197 17.325C146.951 17.325 148.952 16.5211 150.149 15.0844L147.618 13.9898C146.985 14.7766 145.753 15.2554 144.334 15.2554C142.401 15.2554 141.204 14.5884 140.947 13.4425H150.474V12.9636ZM140.93 11.7321C141.135 10.6204 142.281 9.90207 144.094 9.90207C145.89 9.90207 147.156 10.6546 147.19 11.7321H140.93ZM157.794 17.325C161.54 17.325 163.285 16.2303 163.285 14.2806C163.285 12.7241 162.275 11.9374 159.761 11.7321L155.999 11.4414C155.143 11.373 154.801 11.1848 154.801 10.7743C154.801 10.2612 155.503 10.0389 157.008 10.0389C159.214 10.0389 160.616 10.3981 161.779 11.219L163.096 9.66262C161.745 8.61931 159.813 8.12331 157.298 8.12331C153.638 8.12331 151.774 9.064 151.774 10.9454C151.774 12.5189 152.92 13.357 155.4 13.5793L159.094 13.8872C159.967 13.9556 160.24 14.1437 160.24 14.5713C160.24 15.1357 159.624 15.3752 158.102 15.3752C155.451 15.3752 153.861 14.8108 152.749 13.8017L151.158 15.3068C152.544 16.6408 154.682 17.325 157.794 17.325ZM170.756 17.325C174.501 17.325 176.246 16.2303 176.246 14.2806C176.246 12.7241 175.237 11.9374 172.722 11.7321L168.96 11.4414C168.105 11.373 167.762 11.1848 167.762 10.7743C167.762 10.2612 168.464 10.0389 169.969 10.0389C172.175 10.0389 173.578 10.3981 174.741 11.219L176.058 9.66262C174.706 8.61931 172.774 8.12331 170.26 8.12331C166.599 8.12331 164.735 9.064 164.735 10.9454C164.735 12.5189 165.881 13.357 168.361 13.5793L172.055 13.8872C172.928 13.9556 173.201 14.1437 173.201 14.5713C173.201 15.1357 172.586 15.3752 171.063 15.3752C168.412 15.3752 166.822 14.8108 165.71 13.8017L164.119 15.3068C165.505 16.6408 167.643 17.325 170.756 17.325Z"
                  fill="#141943"
                />
                <path
                  d="M159.61 22.4924H155.938V28.1724H156.77V26.1084H159.418C160.802 26.1084 161.706 25.3884 161.706 24.2764C161.706 23.1804 160.89 22.4924 159.61 22.4924ZM159.45 25.4284H156.77V23.1724H159.458C160.322 23.1724 160.842 23.5804 160.842 24.2764C160.842 24.9884 160.306 25.4284 159.45 25.4284ZM166.001 28.3724C168.225 28.3724 169.745 27.1404 169.745 25.3324C169.745 23.5164 168.225 22.2924 166.001 22.2924C163.777 22.2924 162.257 23.5164 162.257 25.3324C162.257 27.1404 163.777 28.3724 166.001 28.3724ZM166.001 27.6844C164.289 27.6844 163.129 26.7244 163.129 25.3324C163.129 23.9324 164.289 22.9804 166.001 22.9804C167.705 22.9804 168.873 23.9324 168.873 25.3324C168.873 26.7324 167.705 27.6844 166.001 27.6844ZM173.786 28.3724C175.698 28.3724 176.666 27.7564 176.666 26.5884C176.666 25.6204 176.05 25.1564 174.602 25.0124L172.842 24.8364C171.802 24.7324 171.45 24.5084 171.45 23.9324C171.45 23.3084 172.13 22.9724 173.386 22.9724C174.762 22.9724 175.474 23.4124 175.802 24.2604L176.634 24.0284C176.202 22.8764 175.194 22.2924 173.41 22.2924C171.602 22.2924 170.594 22.9084 170.594 23.9884C170.594 24.9164 171.194 25.4124 172.498 25.5324L174.338 25.7084C175.386 25.8044 175.802 26.0764 175.802 26.6684C175.802 27.3724 175.17 27.6844 173.794 27.6844C172.306 27.6844 171.45 27.2124 171.122 26.2284L170.274 26.4044C170.682 27.7484 171.802 28.3724 173.786 28.3724Z"
                  fill="#5B5E7B"
                />
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M26.8981 19.9815C27.6894 19.3901 26.8911 17.2664 26.1139 15.6293L24.5847 13.0024C24.5847 13.0024 25.2557 10.9635 24.82 9.59121C24.4391 8.39137 23.9368 7.68284 23.4856 7.04624C23.0078 6.37227 22.5872 5.77892 22.4283 4.76856C22.4283 4.76856 22.6243 1.89696 21.7225 1.55346C21.4873 1.46386 20.4286 3.1218 20.3502 4.76856C20.2994 5.83662 20.9779 6.97681 21.7368 8.25203C22.1481 8.94298 22.5828 9.67357 22.938 10.4538L22.4675 13.0024C22.4675 13.0024 25.3689 19.6678 26.8981 19.9815ZM15.6392 3.19407C15.2648 2.81061 12.6125 2.15368 9.4894 3.27946C6.51904 4.35017 4.99859 6.57298 5.13725 7.71003C5.14185 7.74774 5.02865 7.8489 4.84749 8.01081C4.27515 8.52231 3.0245 9.64001 2.66712 11.278C2.66712 11.278 2.35345 12.5719 3.21604 12.8071C3.21604 12.8071 2.66931 13.8499 2.66712 14.5715C2.66525 15.188 2.94158 16.1007 2.94158 16.1007C0.901775 17.997 0.0550306 18.8841 0.000936516 19.8647C-0.0293488 20.4136 0.678996 21.381 1.53007 21.3154C1.53007 21.3154 0.941943 22.7269 1.41244 23.2758C1.88295 23.8247 3.02 23.6679 3.02 23.6679C2.93 24.0844 2.78374 24.3175 2.64664 24.5361C2.49543 24.7772 2.35537 25.0004 2.31424 25.4323C2.23583 26.2557 3.02 25.5499 3.88258 24.4521C4.74517 23.3542 4.31388 21.433 4.31388 21.433C4.35131 21.3752 4.38933 21.3173 4.42731 21.2595L4.42738 21.2594C4.82691 20.6516 5.22083 20.0523 4.8628 19.551C4.42664 19.0469 3.97364 18.9932 3.27214 18.9101L3.2718 18.9101C3.20337 18.902 3.13258 18.8936 3.0592 18.8845C3.0592 18.8845 6.90164 15.5909 7.01927 14.4539C7.13689 13.3169 5.8038 12.9248 5.8038 12.9248C5.8038 12.9248 6.94085 11.7877 6.86243 10.8467C6.78402 9.90571 6.03905 9.78808 6.03905 9.78808C6.03905 9.78808 8.5484 8.61183 8.97969 7.71003C9.41099 6.80823 8.62681 5.94565 8.62681 5.94565C8.62681 5.94565 10.7833 4.65176 13.0966 4.18126C14.8763 3.81929 15.4493 3.48052 15.6189 3.3435C15.5733 3.7328 15.5705 4.20998 15.6059 4.8086C15.6059 4.8086 15.6057 4.83423 15.6059 4.88156L14.0376 6.22011C14.0376 6.22011 13.6612 5.71039 13.4103 5.94565C11.5283 7.71003 9.9207 9.78808 9.17574 18.5316C8.64792 24.7265 4.8628 27.4711 4.8628 27.4711C4.8628 27.4711 2.82395 29.1353 4.47071 29.0787C9.0189 28.5298 10.548 22.5701 10.548 22.5701C11.2146 21.0017 11.5283 16.1007 11.5283 16.1007C11.698 16.8007 12.5564 17.3057 13.8117 18.0441C14.8764 18.6703 16.2265 19.4645 17.684 20.6881C16.8998 21.5899 17.2527 23.7071 17.2527 23.7071C17.2527 23.7071 18.7426 26.9614 20.4678 28.2945C23.9574 30.991 24.4671 29.7844 24.4671 29.7844C24.9768 28.9219 21.7225 26.5693 21.7225 26.5693C20.0429 25.2651 19.563 24.4952 19.2131 23.0798C20.3839 24.6502 21.1736 25.4323 22.7027 25.9028C24.2318 26.3733 25.4473 26.3058 26.1922 26.0988C26.9372 25.8919 27.8782 23.3934 27.8782 23.3934C27.8782 23.3934 28.0743 21.6683 27.2901 21.5114C26.5059 21.3546 23.0164 21.7859 22.7027 22.0604C22.6433 22.1123 22.6037 22.1446 22.5771 22.1663L22.577 22.1663C22.5412 22.1954 22.5291 22.2053 22.5243 22.218C22.5218 22.2245 22.5212 22.2318 22.5204 22.2428C22.5178 22.2785 22.5122 22.3536 22.4282 22.5701C22.2305 23.0798 25.4473 23.3934 25.4473 23.3934C24.9293 24.193 24.5847 24.3345 23.4869 24.3345C22.8593 24.3345 21.9627 23.0661 20.9875 21.6865C20.2566 20.6526 19.4816 19.5563 18.7426 18.8845C17.8445 18.068 16.5852 17.3472 15.5509 16.7552C14.5984 16.21 13.8367 15.7741 13.7239 15.4733C13.4103 10.6115 15.6059 6.10248 15.6059 6.10248V4.88156C15.6077 5.26047 15.6379 7.03029 16.0372 8.18053C16.4222 9.28943 17.2919 10.7291 18.1937 11.6309C19.0955 12.5327 20.1933 14.5715 20.1933 14.5715C20.4367 15.2832 20.6561 16.004 20.8646 16.689C21.3865 18.4031 21.8399 19.8925 22.4282 20.4528C22.9108 20.6519 23.2516 20.6096 23.3692 20.296C23.4869 19.9823 23.0164 13.5521 19.9189 10.6507C19.9189 10.6507 18.1333 9.00391 18.0369 7.67082C17.6056 1.71112 16.8214 1.55429 16.8214 1.55429C16.1474 1.93052 15.7732 2.33143 15.6392 3.19407ZM17.7232 14.8852C17.2527 14.0226 15.057 10.8859 15.057 10.8859C16.0372 10.533 18.821 12.6111 19.762 14.9244C19.9056 15.2773 18.0752 15.5305 17.7232 14.8852Z"
                  fill="#141943"
                />
              </svg>
            </Link>
          </LogoContainer>
          <MobileMenu onClick={() => setOpenMenu(!openMenu)}>
            <svg
              width="18"
              height="16"
              viewBox="0 0 18 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect width="17.4545" height="1.45455" fill="#141943" />
              <rect
                y="7.27271"
                width="17.4545"
                height="1.45455"
                fill="#141943"
              />
              <rect
                y="14.5454"
                width="17.4545"
                height="1.45455"
                fill="#141943"
              />
            </svg>
          </MobileMenu>
          <CollapsableMenu flex={1} isOpen={openMenu}>
            <Menu>
              <MenuItem>
                <MobileLink to="/productos">Productos</MobileLink>
                <Dropdown dropdownToggle={<span>Productos</span>}>
                  <DropdownItem to="/productos/my-business">
                    Software MyBusiness POS
                  </DropdownItem>

                  <DropdownItem to="/productos/facturacion-electronica">
                    Facturaci贸n Electr贸nica
                  </DropdownItem>

                  <DropdownItem to="/productos/tiempo-aire">
                    Recargas de Tiempo Aire
                  </DropdownItem>
                  <DropdownItem to="/productos/servicios-en-la-nube">
                    Servicios en la Nube
                  </DropdownItem>
                  <DropdownItem to="/productos/pos-tools">
                    Venta en ruta para Android
                  </DropdownItem>
                  <DropdownItem to="/productos/bill-pocket">
                    Cobro con tarjeta (Bill Pocket)
                  </DropdownItem>
                  <DropdownItem to="/productos/desarrollo-a-la-medida">
                    Modificaciones a la medida
                  </DropdownItem>
                </Dropdown>
              </MenuItem>
              <MenuItem>
                <Link to="/corporativos/">Corporativos</Link>
              </MenuItem>
              <MenuItem>
                <Link to="/descargas/">Descargas</Link>
              </MenuItem>
              <MenuItem>
                <MobileLink to="/capacitacion">Capacitacion</MobileLink>
                <Dropdown dropdownToggle={<span>Capacitaci贸n</span>}>
                  <DropdownItem to="/capacitacion/cursos-virtuales-gratuitos">
                    Cursos Virtuales Gratuitos
                  </DropdownItem>

                  <DropdownItem to="/capacitacion/cursos-virtuales-con-certificacion">
                    Cursos Virtuales con Certificaci贸n
                  </DropdownItem>
                </Dropdown>
              </MenuItem>
              <MenuItem>
                <MobileLink to="/soporte">Soporte</MobileLink>
                <Dropdown dropdownToggle={<span>Soporte</span>}>
                  <DropdownItem to="/soporte/preguntas-frecuentes">
                    Preguntas Frecuentes
                  </DropdownItem>

                  <DropdownItem to="/soporte/manuales">Manuales</DropdownItem>
                  <DropdownItem to="/soporte/video-tutoriales">
                    Videotutoriales
                  </DropdownItem>
                </Dropdown>
              </MenuItem>
              <MenuItem>
                <Link to="/contacto/">Contacto</Link>
              </MenuItem>
            </Menu>
          </CollapsableMenu>
        </Layout.Row>
      </Layout.Container>
    </HeaderContainer>
  );
};

const StyledHeader = styled(Header)`
  color: var(--white);
  background: var(--primary-color);
  padding: 1rem 0;
  margin-bottom: 1rem;
  h1 {
    margin: 0;
  }
`;

const HeaderContainer = styled.header`
  padding: 1.5rem 0;
`;

export const Menu = styled.div`
  display: flex;
  padding-left: 2rem;
`;

export const MenuItem = styled.div`
  transition: all 0.3s ease-in-out;
  font-size: 0.9rem;

  > a,
  span {
    padding: 1rem 1.5rem;
    display: block;
    position: relative;
    font-weight: bold;

    &:after {
      content: " ";
      height: 2px;
      background: ${theme.colors.bodyLColor};
      position: absolute;
      bottom: 0;
      left: 1.5rem;
      right: 1.5rem;
      opacity: 0;
      transition: all 0.3s ease-in-out;
    }

    &:hover:after {
      opacity: 1;
    }
  }
`;

export const CollapsableMenu = styled(Layout.Column)<{
  isOpen: boolean;
}>`
  @media ${theme.breakpoint.onlyMobile} {
    display: none;
  }

  ${props =>
    props.isOpen &&
    css`
      @media ${theme.breakpoint.onlyMobile} {
        display: block !important;
        position: absolute;
        top: 5.5rem;
        width: 100%;
        left: 0;
        background: ${theme.colors.bodyColor};
        padding: 0;
        z-index: 1000;
        height: 100vh;

        > div {
          flex-direction: column;
          padding-left: 0;
        }

        a {
          color: #fff;
          padding: 1.5rem;
          text-align: center;
          border-bottom: 1px solid ${theme.colors.bodyLColor};

          &:hover {
            border-bottom: 1px solid ${theme.colors.bodyLColor};
          }
        }
      }
    `}
`;

export const MobileMenu = styled.button`
  border: 0;
  background: none;
  padding: 1rem;
  cursor: pointer;
  @media ${theme.breakpoint.upFromMobile} {
    display: none;
  }
`;

export const LogoContainer = styled(Layout.Column)`
  @media ${theme.breakpoint.onlyMobile} {
    flex: 1;
  }
`;

export const MobileLink = styled(Link)`
  @media ${theme.breakpoint.upFromMobile} {
    display: none !important;
  }
`;
